{% extends 'base.html' %}

{% load static %}

{% block title %}PengBeats | Custom Recommender {% endblock %}

{% block content %}

<h1>Custom Recommender</h1>
<form name="recForm" method="post">
    {% csrf_token %}
    <table>
        <tr>
            <td>
                <h2>Artists</h2>
                <input type="text" class="form-control" id="artistterm" placeholder="Search artists...">
                <div id="search_artists" style="text-align: left;">
                    {% include 'recommender/custom_recommender_artist.html' %}
                </div>
                <div id="final_artists"></div>
            </td>
        </tr>
        <tr>
            <td>
                <h2>Genre</h2>
                <select class="form-select" name="genre" id="genre">
                    <option value="blues">Blues</option>
                    <option value="alternative">Alternative</option>
                    <option value="anime">Anime</option>
                    <option value="classical">Classical</option>
                    <option value="country">Country</option>
                    <option value="disco">Disco</option>
                    <option value="electronic">Electronic</option>
                    <option value="emo">Emo</option>
                    <option value="folk">Folk</option>
                    <option value="opera">Opera</option>
                    <option value="gospel">Gospel</option>
                    <option value="grunge">Grunge</option>
                    <option value="hard-rock">Hard Rock</option>
                    <option value="hip-hop">Hip Hop</option>
                    <option value="indie">Indie</option>
                    <option value="jazz">Jazz</option>
                    <option value="k-pop">K-pop</option>
                    <option value="latin">Latin</option>
                    <option value="metal">Metal</option>
                    <option value="pop">Pop</option>
                    <option value="punk">Punk</option>
                    <option value="r-n-b">R&B</option>
                    <option value="reggae">Reggae</option>
                    <option value="rock">Rock</option>
                    <option value="soul">Soul</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <h2>Track</h2>
                <input type="text" class="form-control" id="trackterm" placeholder="Search tracks...">
                <div id="search_tracks" style="text-align: left;">
                    {% include 'recommender/custom_recommender_track.html' %}
                </div>
                <div id="final_tracks"></div>
            </td>
        </tr>
        <tr>
            <td>
                <button type="button" id="submit" class="btn btn-dark genreBtn">Get Recommendations!</button>
            </td>
        </tr>   
    </table>
</form>
<script src="{% static 'js/custom_recommender_artist.js' %}"></script>
<script src="{% static 'js/custom_recommender_track.js' %}"></script>
<script>
    let tracks = [];
    let artists = [];
    function createCheckbox(id, name, type, new_class) {
        if (type == 'artist') {
            var hold = document.getElementById("final_artists");
        }
        if (type == 'track') {
            var hold = document.getElementById("final_tracks");
        }
        if(document.getElementById(id) == null && checkMaxArtists() & checkMaxTrack()){
                var checkbox = document.createElement('input');
                checkbox.type = "checkbox";
                checkbox.name = name;
                checkbox.value = id;
                checkbox.id = id;
                checkbox.className = new_class;
                checkbox.checked = true;
                var label = document.createElement('label');
                label.className = new_class;
                label.className += " " + id;
                var tn = document.createTextNode(name);
                label.htmlFor=id;
                label.appendChild(tn); 
                hold.appendChild(label);
                hold.appendChild(checkbox);
            }
    }
</script>


<script>
    document.addEventListener('click', function (e) {
    if (hasClass(e.target, 'artist_check')) {
        let x = document.getElementsByClassName("artist_check");
        let arr = [];
        // console.log(x.length);
        // console.log("target")
        // console.log(e.target)
        let selected = e.target;
        let selectedArr = selected.classList
        // console.log("SELECTED'S Class")
        // console.log(selectedArr);
        // console.log("SELECTED LENGTH")
        // console.log(selectedArr.length)
        // console.log("SELECTED'S ID")
        // console.log(selected.id);
        for(let i = x.length-1; i >= 0; i--){
            // console.log("element")
            // console.log(x[i]);
            // console.log("element class list")
            // console.log(x[i].classList);
            // console.log("element id")
            // console.log(x[i].id);
            if(x[i].classList == selectedArr){
                // console.log("1 removed")
                x[i].checked = false;
                x[i].remove();
            }
            else if((x[i].id == selected.id) && selected.id !== "" && x[i].id !== ""){
                // console.log(typeof(x[i]))
                // console.log("2 removed")
                x[i].checked = false;
                x[i].remove();
                
            }
            else if(x[i].classList == selectedArr){
                // console.log("3 removed")
                x[i].checked = false;
                x[i].remove();
                
                // console.log(x.length);
            }
            else if(x[i].classList.contains(selected.id)){
                // console.log("4 removed")
                x[i].checked = false;
                x[i].remove();
                
            }
            else if(selectedArr.contains(x[i].id)){
                // console.log("5 removed")
                x[i].checked = false;
                x[i].remove();
            }
            // console.log("selected length on pass " + i)  ;         
            // console.log(x.length);
        }
        // console.log(x);
    } else if (hasClass(e.target, 'track_check')) {
        let y = document.getElementsByClassName("track_check");
        let x = document.getElementsByClassName("artist_check");
        let arr = [];
        let selected = e.target;
        let selectedArr = selected.classList
        for(let i = y.length-1; i >= 0; i--){
            if(y[i].classList == selectedArr){
                y[i].checked = false;
                y[i].remove();
            }
            else if((y[i].id == selected.id) && selected.id !== "" && y[i].id !== ""){
                y[i].checked = false;
                y[i].remove();
                
            }
            else if(y[i].classList == selectedArr){
                y[i].checked = false;
                y[i].remove();
            }
            else if(y[i].classList.contains(selected.id)){
                y[i].checked = false;
                y[i].remove();
            }
            else if(selectedArr.contains(y[i].id)){
                y[i].checked = false;
                y[i].remove();
            }
        }
    }
}, false);

function hasClass(elem, className) {
    return elem.className.split(' ').indexOf(className) > -1;
}
</script>

<script>
    function checkMaxArtists() {
      console.log("Check")
      let total=0;
      if(document.recForm.artist_check){
          for(var i=0; i < document.recForm.artist_check.length; i++){
              if(document.recForm.artist_check[i].checked){
                  console.log("true");
                  total = total + 1;
                  console.log(total);
              }
              if(total > 3){
                  alert("Please select only three artists");
                  return false;
              }
          }
      }
      return true;
    }
  </script>
  
  <script>
      function checkMaxTrack() {
        console.log("Check")
        let total=0;
        console.log(document.recForm.track_check)
        if(typeof document.recForm.track_check !== 'undefined'){
          for(var i=0; i < document.recForm.track_check.length; i++){
              if(document.recForm.track_check[i].checked){
              console.log("true");
              total = total + 1;
              console.log(total);
              }
              if(total > 1){
              alert("Please select only one song");
              return false;
              }
          }
        }
        return true;
      }
    </script>



{% endblock %}