{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>{% block title %}{% endblock %}</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="stylesheet" href="{% static 'css/my_style.css' %}">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> 

        <link rel="shortcut icon" href="{% static 'images/favicon.ico' type='image/x-icon' %}">

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet"> 

        <!-- Imported Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Lato" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">

        <!-- CSS -->
        <link rel="stylesheet" href="{% static 'css/base.css' %}">

        <!-- JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/shortcuts/infinite.min.js"></script>

    </head>

    <body>

        <!-- Bootstrap Navbar -->
          <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
              <a class="navbar-brand pengbeatslogo" href="{% url 'recommender:home' %}">
                <img src="{% static 'images/penguin.png' type='image/png' %}" alt="" width="30" height="30" class="d-inline-block align-top">
                PengBeats
              </a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <!-- <li class="nav-item">
                    <a class="nav-link" href="{% url 'recommender:best' %}">Browse</a>
                  </li> -->
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Top
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                      <li><a class="dropdown-item" href="{% url 'recommender:top_tracks' %}">Top Tracks</a></li>
                      <li><a class="dropdown-item" href="{% url 'recommender:top_playlists' %}">Top Playlists</a></li>
                    </ul>
                  </li>
                  {% if user.is_authenticated %}
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'recommender:survey_genres' %}">Survey</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'recommender:user_preference_recommender' %}">Explore</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'feed:feed' %}">Feed</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'user:get_playlists' user.id %}">Playlists</a>
                    </li>
                  {% endif %}
                  <li class="nav-item">
                    <a class="nav-link" onClick="pageClick('/about/')">About</a>
                  </li>
                </ul>
                {% if request.get_full_path != "/" %}
                  <form class="d-flex" method="POST" action="{% url 'recommender:results' %}" style="text-align: center; margin: auto">
                    {% csrf_token %}
                    <input class="form-control me-2 searchbar" type="search" placeholder="Search" aria-label="Search" name="term" style="color: black; width: 350px;" id="searchterm">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                  </form>
                {% endif %}
                {% if user.is_authenticated %}
                  <a class="nav-link dropdown-toggle link-light" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    {{ user.username }}
                  </a>
                  <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="navbarDropdownMenuLink">
                    <li><a class="dropdown-item" href="{% url 'user:profile' user.id %}">Profile</a></li>
                    <li><a class="dropdown-item" href="{% url 'user:follow_page' user.id %}">Following</a></li>
                    <li><a class="dropdown-item" href="{% url 'user:update_profile' %}">Settings</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{% url 'user:logout' %}">Log Out</a></li>
                  </ul>
                {% else %}
                  <a class="btn btn-light" href="{% url 'user:login' %}" role="button">Login</a> &nbsp;&nbsp;
                  <a class="btn btn-success" href="{% url 'user:signup' %}" role="button">Sign Up</a>
                {% endif %}
              </div>
            </div>
          </nav>

        <!-- End Bootstrap Navbar -->

        <div class="container" style="z-index: -1;" id="basecontainer">
            {% load static %}
            {% block content %}
            {% endblock %}
        </div>
        <br><br>
        <br><br>
        <script id="scriptcontainer"></script>
        {% if user.is_authenticated or profile %}
          <nav class="navbar fixed-bottom">
            <div class="w3-row" style="width: 100%;">
              <div class="w3-col m3 ">
                <table>
                  <tr>
                    <td>
                      <img id="albumpic" src="" height="60" width="60">
                    </td>
                    <td>
                      <div style="text-align: left;">
                        <label for='songtitle'><b>Currently playing:</b></label><br>
                        <span style="text-align: left; font-size: small;" id="songtitle"></span><br>
                        <span style="text-align: left; font-size: x-small;" id="artistname"></span>
                      </div>
                    </td>
                  </tr>
                </table>
              </div>
              <div class="w3-col m6  w3-center">
                <table class="center" style="width:100%; text-align: center;">
                  <tr>
                    <td>
                      <div class="btn-group" style=" text-align: center;" role="group">
                        <button id="shuffle" class="btn btn-dark" type="button" style="background-color: transparent; border:transparent;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"/>
                            <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/>
                          </svg>
                        </button>
                        <button id="prevTrack" class="btn btn-dark" type="button" style="background-color: transparent; border:transparent;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left" viewBox="0 0 16 16">
                            <path d="M10 12.796V3.204L4.519 8 10 12.796zm-.659.753-5.48-4.796a1 1 0 0 1 0-1.506l5.48-4.796A1 1 0 0 1 11 3.204v9.592a1 1 0 0 1-1.659.753z"/>
                          </svg>
                        </button>
                        <button id="playpauseBtn" class="btn btn-dark" type="button" style="background-color: transparent; border:transparent;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pause-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M5 6.25a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0v-3.5zm3.5 0a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0v-3.5z"/>
                          </svg>
                        </button>
                        <button id="nextTrack" class="btn btn-dark" type="button" style="background-color: transparent; border:transparent;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right" viewBox="0 0 16 16">
                            <path d="M6 12.796V3.204L11.481 8 6 12.796zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753z"/>
                          </svg>
                        </button>
                        <button id="repeat" class="btn btn-dark" type="button" style="background-color: transparent; border:transparent;">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                            <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
                            <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
                          </svg>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <progress style="width:80%;" id="songprogress" value="" max=""></progress>
                    </td>
                  </tr>
                </table>
              </div>
              <div class="w3-col m3 w3-red w3-center">

              </div>
            </div> 
          </nav>
          <input hidden id='access_token' value='{{ profile.access_token }}'>

          <script src="https://sdk.scdn.co/spotify-player.js"></script>
          <script src="{% static 'js/webplayer.js' %}"></script>
        {% endif %}
        <script src="{% static 'js/livesearch.js' %}"></script>
        <script>
          let previousURL;
          function pageClick(url) {
            previousURL = location.pathname;
            console.log('URL ' + url);
            console.log('PREVURL ' + previousURL);
            $('#basecontainer').load(url + ' #basecontainer', function (responseText) {
              var title = responseText.match(/<title>([^<]*)/)[1];
              document.title = title;
              history.pushState({}, '', url);
            })
          }

          window.onpopstate = function(event) {
            if(event) {
              console.log(event);
              location.reload();
            }
          }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
      </body>

</html>