{% extends 'base.html' %}

{% load static %}

{% block title %}PengBeats | Survey{% endblock %}

{% block content %}
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Yoinked from https://www.plus2net.com/javascript_tutorial/checkbox-limit.php -->
<script type="text/javascript">
  function checkMax() {
    console.log("Check")
    let total=0;
    for(var i=0; i < document.songForm.song.length; i++){
      if(document.songForm.song[i].checked){
        console.log("true");
        total = total + 1;
        console.log(total);
      }
      if(total > 5){
        alert("Please select only 5 songs");
        document.songForm.song[i].checked = false;
        return false;
      }
    }
  }
</script>
<script type="text/javascript">
  function checkMin() {
    $.each($("input[name='art']:checked"), function() {
        checked.push($(this).val());
    });
    let total=0;
    for(var i=0; i < document.artistForm.art.length; i++){
      if(document.artistForm.art[i].checked){
        total = total + 1;
       }
      if(total < 1){
        alert("Please select at least one artist") 
        document.artistForm.art[i] = false ;
        return false;
      }
    }
    return true;
  } 
</script>

<center>
  <h1 style="font-size: 400%;">Survey</h1>
</center>
<br>

<h3>Pick up to 5 songs from {{ artist_names.0 }} 
    {% if artist_names.1 %}
    or {{ artist_names.1 }}
    {% endif %}
    {% if artist_names.2 %}
    or {{ artist_names.2 }}
    {% endif %}
</h3>

<!-- <table>
{% for track in track_ids %}
  <tr>
    <td>
      {{track}}
      <iframe src="https://open.spotify.com/embed/track/{{ track }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
    </td>
  </tr>
{% endfor %}
</table> -->





<form name="songForm" method="post">
  {% csrf_token %}
  <table>
    <tr>
      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.0 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        <input type="checkbox" id="g1" name="song" value="{{ track_ids.0 }}" onclick="checkMax()">
        <label for="g1">{{ track_names.0 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.1 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        <input type="checkbox" id="g2" name="song" value="{{ track_ids.1 }}" onclick="checkMax()">
        <label for="g2">{{ track_names.1 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.2 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g3" name="song" value="{{ track_ids.2 }}" onclick="checkMax()">
        <label for="g3">{{ track_names.2 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.3 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g4" name="song" value="{{ track_ids.3 }}" onclick="checkMax()">
        <label for="g4">{{ track_names.3 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.4 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g5" name="song" value="{{ track_ids.4 }}" onclick="checkMax()">
        <label for="g5">{{ track_names.4 }}</label><br>
      </td>
    </tr>

    {% if track_ids.5 %}    
    <tr>
      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.5 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g6" name="song" value="{{ track_ids.5 }}" onclick="checkMax()">
        <label for="g6">{{ track_names.5 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.6 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        
        <input type="checkbox" id="g7" name="song" value="{{ track_ids.6 }}" onclick="checkMax()">
        <label for="g7">{{ track_names.6 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.7 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g8" name="song" value="{{ track_ids.7 }}" onclick="checkMax()">
        <label for="g8">{{ track_names.7 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.8 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g9" name="song" value="{{ track_ids.8 }}" onclick="checkMax()">
        <label for="g9">{{ track_names.8 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.9 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g10" name="song" value="{{ track_ids.9 }}" onclick="checkMax()">
        <label for="g10">{{ track_names.9 }}</label><br>
      </td>
    </tr>
    {% endif %}
    
    {% if track_ids.10 %}
    <tr>
      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.10 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
        
        <input type="checkbox" id="g11" name="song" value="{{ track_ids.10 }}" onclick="checkMax()">
        <label for="g11">{{ track_names.10 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.11 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g12" name="song" value="{{ track_ids.11 }}" onclick="checkMax()">
        <label for="g12">{{ track_names.11 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.12 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g13" name="song" value="{{ track_ids.12 }}" onclick="checkMax()">
        <label for="g13">{{ track_names.12 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.13 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g14" name="song" value="{{ track_ids.13 }}" onclick="checkMax()">
        <label for="g14">{{ track_names.13 }}</label><br>
      </td>

      <td>
        <iframe src="https://open.spotify.com/embed/track/{{ track_ids.14 }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

        <input type="checkbox" id="g15" name="song" value="{{ track_ids.14 }}" onclick="checkMax()">
        <label for="g15">{{ track_names.14 }}</label><br>
      </td>
    </tr>
    {% endif %}
  </table>
  <div style="margin-left: 10%;">
    <button type="button" id="submit" class="btn btn-dark songBtn" style="height: 50px; width: 110px">Submit</button>
  </div>
  <div>
    <button type="button" class="btn btn-dark refreshBtn" style="height: 50px; width: 110px">Refresh Options</button>
  </div>
  <script>
    $('.refreshBtn').click(function(e) {
      $('input[name="art"]').each(function() {
        this.checked = false;
      });
      location.reload(true);
    })

    $('.songBtn').click(function(e) {
        let song_ids = [];
        $.each($("input[name='song']:checked"), function() {
            song_ids.push($(this).val());
        });
        if (song_ids.length >= 1) {
            $.ajax({
                type: 'POST',
                url: '{% url "recommender:check_remaining" genre_stack songs_list %}',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    song_id_list: song_ids,
                },
                success: function(response) {
                  let url = response.redirect;
                  //console.log(genre_stack)
                  // let string = '{% url "recommender:survey_artists" '
                  let s = "/"
                  window.location.href = s.concat(url);
                  // string = "http://localhost:8000/survey_artists/"
                  // window.location.href = string.concat(genre_stack)
                }
            });
        }
        else {
            e.preventDefault();
        }
    });
  </script>
</form>


{% endblock %}