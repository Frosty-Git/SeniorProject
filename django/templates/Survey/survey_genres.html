{% extends 'base.html' %}

{% load static %}

{% block title %}PengBeats | Survey{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/survey_genres.css' %}">
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Yoinked from https://www.plus2net.com/javascript_tutorial/checkbox-limit.php -->
<script type="text/javascript">
  function checkMax() {
    let total=0;
    for(var i=0; i < document.genreForm.gen.length; i++){
      if(document.genreForm.gen[i].checked){
        total = total + 1;}
      if(total > 3){
        alert("Please select only three genres");
        document.genreForm.gen[i].checked = false ;
        return false;
      }
    }
  } 
</script>
<script type="text/javascript">
  function checkMin() {
    $.each($("input[name='gen']:checked"), function() {
        checked.push($(this).val());
    });
    let total=0;
    for(var i=0; i < document.genreForm.gen.length; i++){
      if(document.genreForm.gen[i].checked){
        total = total + 1;
       }
      if(total < 1){
        alert("Please select at least one genre") 
        document.genreForm.gen[i] = false ;
        return false;
      }
    }
    return true;
  } 
</script>

<center>
  <h1 style="font-size: 400%;">Survey</h1>
</center>
<br>

<h3>Pick up to 3 genres you like.</h3>
<form name="genreForm" method="post">
  {% csrf_token %}
  <table id="genretable">
    <tr>
      <td>
        <input type="checkbox" id="g1" name="gen" class="form-check-input" value="blues" onclick="checkMax()">
        <label for="g1">Blues</label><br>
      </td>

      <td>
        <input type="checkbox" id="g2" name="gen" class="form-check-input" value="alternative" onclick="checkMax()">
        <label for="g2">Alternative</label><br>
      </td>

      <td>
        <input type="checkbox" id="g3" name="gen" class="form-check-input" value="anime" onclick="checkMax()">
        <label for="g3">Anime</label><br>
      </td>

      <td>
        <input type="checkbox" id="g4" name="gen" class="form-check-input" value="classical" onclick="checkMax()">
        <label for="g4">Classical</label><br>
      </td>

      <td>
        <input type="checkbox" id="g5" name="gen" class="form-check-input" value="country" onclick="checkMax()">
        <label for="g5">Country</label><br>
      </td>
    </tr>

    <tr>
      <td>
        <input type="checkbox" id="g6" name="gen" class="form-check-input" value="disco" onclick="checkMax()">
        <label for="g6">Disco</label><br>
      </td>

      <td>
        <input type="checkbox" id="g7" name="gen" class="form-check-input" value="electronic" onclick="checkMax()">
        <label for="g7">Electronic</label><br>
      </td>

      <td>
        <input type="checkbox" id="g8" name="gen" class="form-check-input" value="emo" onclick="checkMax()">
        <label for="g8">Emo</label><br>
      </td>

      <td>
        <input type="checkbox" id="g9" name="gen" class="form-check-input" value="folk" onclick="checkMax()">
        <label for="g9">Folk</label><br>
      </td>

      <td>
        <input type="checkbox" id="g10" name="gen" class="form-check-input" value="opera" onclick="checkMax()">
        <label for="g10">Opera</label><br>
      </td>
    </tr>

    <tr>
      <td>
        <input type="checkbox" id="g11" name="gen" class="form-check-input" value="gospel" onclick="checkMax()">
        <label for="g11">Gospel</label><br>
      </td>

      <td>
        <input type="checkbox" id="g12" name="gen" class="form-check-input" value="grunge" onclick="checkMax()">
        <label for="g12">Grunge</label><br>
      </td>

      <td>
        <input type="checkbox" id="g13" name="gen" class="form-check-input" value="hard-rock" onclick="checkMax()">
        <label for="g13">Hard Rock</label><br>
      </td>

      <td>
        <input type="checkbox" id="g14" name="gen" class="form-check-input" value="hip-hop" onclick="checkMax()">
        <label for="g14">Hip Hop</label><br>
      </td>

      <td>
        <input type="checkbox" id="g15" name="gen" class="form-check-input" value="indie" onclick="checkMax()">
        <label for="g15">Indie</label><br>
      </td>
    </tr>

    <tr>
      <td>
        <input type="checkbox" id="g16" name="gen" value="jazz" class="form-check-input" onclick="checkMax()">
        <label for="g16">Jazz</label><br>
      </td>

      <td>
        <input type="checkbox" id="g17" name="gen" value="k-pop" class="form-check-input" onclick="checkMax()">
        <label for="g17">K-pop</label><br>
      </td>

      <td>
        <input type="checkbox" id="g18" name="gen" value="latin" class="form-check-input" onclick="checkMax()">
        <label for="g18">Latin</label><br>
      </td>

      <td>
        <input type="checkbox" id="g19" name="gen" value="metal" class="form-check-input" onclick="checkMax()">
        <label for="g19">Metal </label><br>
      </td>

      <td>
        <input type="checkbox" id="g20" name="gen" value="pop" class="form-check-input" onclick="checkMax()">
        <label for="g20">Pop</label><br>
      </td>
    </tr>

    <tr>
      <td>
        <input type="checkbox" id="g21" name="gen" value="punk" class="form-check-input" onclick="checkMax()">
        <label for="g21">Punk</label><br>
      </td>

      <td>
        <input type="checkbox" id="g22" name="gen" value="r-n-b" class="form-check-input" onclick="checkMax()">
        <label for="g22">R&B</label><br>
      </td>

      <td>
        <input type="checkbox" id="g23" name="gen" value="reggae" class="form-check-input" onclick="checkMax()">
        <label for="g23">Reggae</label><br>
      </td>

      <td>
        <input type="checkbox" id="g24" name="gen" value="rock" class="form-check-input" onclick="checkMax()">
        <label for="g24">Classic Rock</label><br>
      </td>

      <td>
        <input type="checkbox" id="g25" name="gen" value="soul" class="form-check-input" onclick="checkMax()">
        <label for="g25">Soul</label><br>
      </td>
    </tr>
  </table>
  <br>
  <div >
    <button type="button" id="submit" class="btn btn-outline-light" >Submit</button>
  </div>
  <script>
    $('.btn-outline-light').click(function(e) {
        let checked = [];
        $.each($("input[name='gen']:checked"), function() {
            checked.push($(this).val());
        });
        if (checked.length >= 1) {
            console.log(checked);
            $.ajax({
                type: 'POST',
                url: '{% url "recommender:create_genre_stack" %}',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    checked_list: checked,
                },
                success: function(response) {
                  let url = response.stack;
                  //console.log(genre_stack)
                  // let string = '{% url "recommender:survey_artists" '
                  let s = "/"
                  window.location.href = s.concat(url);
                  // string = "http://localhost:8000/survey_artists/"
                  // window.location.href = string.concat(genre_stack)
                }
            });
        }
        else {
            alert("Please select at least one genre")
            e.preventDefault();
        }
    });
  </script>
</form>


{% endblock %}